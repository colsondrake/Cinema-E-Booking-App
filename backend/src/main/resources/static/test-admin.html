<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CES Admin + Order API Tester</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        input,
        select {
            margin: 5px;
            padding: 5px;
        }

        button {
            padding: 7px 12px;
            margin-top: 5px;
        }

        .box {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
        }

        pre {
            background: #f9f9f9;
            padding: 10px;
        }
    </style>
</head>

<body>

    <h1>CES Admin + Order API Tester</h1>
    <p>Base URL: <strong>http://localhost:8080</strong></p>

    <!-- ============================
         ADD MOVIE
    =============================== -->
    <div class="box">
        <h2>Add Movie</h2>
        <input id="m_title" placeholder="Title"><br>
        <input id="m_director" placeholder="Director"><br>
        <input id="m_year" placeholder="Year" type="number"><br>
        <input id="m_rating" placeholder="Rating (PG, R, etc.)"><br>
        <input id="m_poster" placeholder="Poster URL"><br>
        <input id="m_trailer" placeholder="Trailer URL"><br>
        <input id="m_description" placeholder="Description"><br>

        <button onclick="addMovie()">Add Movie</button>
    </div>

    <!-- ============================
         LIST MOVIES
    =============================== -->
    <div class="box">
        <h2>List Movies</h2>
        <button onclick="listMovies()">Load Movies</button>
        <pre id="movies_output"></pre>
    </div>

    <!-- ============================
         ⭐ NEW: GET MOVIE DETAIL
    =============================== -->
    <div class="box">
        <h2>⭐ Get Movie Details (Check showtimes[])</h2>
        <input id="md_movieId" placeholder="Movie ID"><br>
        <button onclick="getMovieDetail()">Get Movie</button>
        <pre id="movie_detail_output"></pre>
    </div>

    <!-- ============================
         ADD SHOWTIME
    =============================== -->
    <div class="box">
        <h2>Add Showtime</h2>
        <input id="s_movieId" placeholder="Movie ID"><br>
        <input id="s_showroomId" placeholder="Showroom ID"><br>
        <input id="s_date" type="date"><br>
        <input id="s_time" placeholder="Time (e.g. 18:00)"><br>

        <button onclick="addShowtime()">Add Showtime</button>
    </div>

    <!-- ============================
         LIST SHOWTIMES BY MOVIE
    =============================== -->
    <div class="box">
        <h2>List Showtimes for Movie</h2>
        <input id="ls_movieId" placeholder="Movie ID"><br>
        <button onclick="listShowtimes()">Load Showtimes</button>
        <pre id="showtimes_output"></pre>
    </div>

    <!-- ============================
         CREATE PROMOTION
    =============================== -->
    <div class="box">
        <h2>Create Promotion</h2>
        <input id="p_code" placeholder="Promo Code"><br>
        <input id="p_discount" type="number" placeholder="Discount %"><br>
        <input id="p_start" type="date"><br>
        <input id="p_end" type="date"><br>

        <button onclick="createPromotion()">Create Promotion</button>
    </div>

    <!-- ============================
         LIST PROMOTIONS
    =============================== -->
    <div class="box">
        <h2>List Promotions</h2>
        <button onclick="listPromotions()">Load Promotions</button>
        <pre id="promotions_output"></pre>
    </div>

    <!-- ============================
         SEND PROMOTION EMAILS
    =============================== -->
    <div class="box">
        <h2>Send Promotion</h2>
        <input id="sp_promoId" placeholder="Promotion ID"><br>
        <button onclick="sendPromotion()">Send Emails</button>
    </div>

    <!-- ============================
         ⭐ NEW: GET PROMOTION BY CODE
    =============================== -->
    <div class="box">
        <h2>⭐ Lookup Promotion by Code</h2>
        <input id="promo_lookup_code" placeholder="Promo Code"><br>
        <button onclick="lookupPromotion()">Lookup</button>
        <pre id="promo_lookup_output"></pre>
    </div>

    <!-- ============================
         SEAT API TESTING
    =============================== -->
    <div class="box">
        <h2>Seat API Testing</h2>

        <h3>Get Taken Seats</h3>
        <input id="seat_showtimeId" placeholder="Showtime ID"><br>
        <button onclick="getTakenSeats()">Get Taken Seats</button>
        <pre id="taken_output"></pre>

        <h3>Reserve Seats</h3>
        <input id="reserve_showtimeId" placeholder="Showtime ID"><br>
        <input id="reserve_seats" placeholder='Seats (e.g. ["A1","A2"])'><br>
        <button onclick="reserveSeats()">Reserve</button>
    </div>

    <!-- ============================================
         ⭐⭐⭐ NEW: ORDER API TESTING ⭐⭐⭐
    ============================================= -->
    <div class="box">
        <h2>Create Order</h2>
        <input id="o_userId" placeholder="User ID"><br>
        <input id="o_showtimeId" placeholder="Showtime ID"><br>
        <input id="o_seats" placeholder='Seats (e.g. ["A1","A2"])'><br>
        <input id="o_total" type="number" placeholder="Total Price"><br>

        <button onclick="createOrder()">Create Order</button>
        <pre id="order_create_output"></pre>
    </div>

    <div class="box">
        <h2>Get User Order History</h2>
        <input id="o_userId_hist" placeholder="User ID"><br>
        <button onclick="getUserOrders()">Load History</button>
        <pre id="order_history_output"></pre>
    </div>

    <script>
        const BASE = "http://localhost:8080";

        // ================= MOVIES =================

        function addMovie() {
            const body = {
                title: m_title.value,
                director: m_director.value,
                year: parseInt(m_year.value),
                rating: m_rating.value,
                posterUrl: m_poster.value,
                trailerUrl: m_trailer.value,
                description: m_description.value
            };

            fetch(`${BASE}/api/admin/movies`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            })
                .then(r => r.text())
                .then(alert);
        }

        function listMovies() {
            fetch(`${BASE}/api/admin/movies`)
                .then(r => r.json())
                .then(data => movies_output.textContent = JSON.stringify(data, null, 2));
        }

        function getMovieDetail() {
            const id = md_movieId.value;
            fetch(`${BASE}/api/movies/${id}`)
                .then(r => r.json())
                .then(data => movie_detail_output.textContent = JSON.stringify(data, null, 2));
        }

        // ================= SHOWTIMES =================

        function addShowtime() {
            const movieId = s_movieId.value;
            const showroomId = s_showroomId.value;
            const date = s_date.value;
            const time = s_time.value;

            fetch(`${BASE}/api/admin/showtimes?movieId=${movieId}&showroomId=${showroomId}&date=${date}&time=${time}`, {
                method: "POST"
            })
                .then(r => r.text())
                .then(alert);
        }

        function listShowtimes() {
            const movieId = ls_movieId.value;
            fetch(`${BASE}/api/admin/showtimes?movieId=${movieId}`)
                .then(r => r.json())
                .then(data => showtimes_output.textContent = JSON.stringify(data, null, 2));
        }

        // ================= PROMOTIONS =================

        function createPromotion() {
            const body = {
                promotionCode: p_code.value,
                discountPercent: parseFloat(p_discount.value),
                startDate: p_start.value,
                endDate: p_end.value
            };

            fetch(`${BASE}/api/admin/promotions`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            })
                .then(r => r.text())
                .then(alert);
        }

        function listPromotions() {
            fetch(`${BASE}/api/admin/promotions`)
                .then(r => r.json())
                .then(data => promotions_output.textContent = JSON.stringify(data, null, 2));
        }

        function sendPromotion() {
            const promoId = sp_promoId.value;
            fetch(`${BASE}/api/admin/promotions/${promoId}/send`, { method: "POST" })
                .then(r => r.text())
                .then(alert);
        }

        // NEW: Lookup promotion by code
        function lookupPromotion() {
            const code = promo_lookup_code.value;

            fetch(`${BASE}/api/promotions/${code}`)
                .then(r => r.json())
                .then(data => promo_lookup_output.textContent = JSON.stringify(data, null, 2))
                .catch(err => promo_lookup_output.textContent = err);
        }

        // ================= SEATS =================

        function getTakenSeats() {
            const id = seat_showtimeId.value;

            fetch(`${BASE}/api/showtimes/${id}/seats`)
                .then(r => r.json())
                .then(data => taken_output.textContent = JSON.stringify(data, null, 2));
        }

        function reserveSeats() {
            const id = reserve_showtimeId.value;
            const seats = JSON.parse(reserve_seats.value);

            fetch(`${BASE}/api/showtimes/${id}/reserve`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(seats)
            })
                .then(r => r.text())
                .then(alert);
        }

        // ================= ORDERS =================

        function createOrder() {
            let seats;

            try { seats = JSON.parse(o_seats.value); }
            catch { return alert("Seats must be JSON array like [\"A1\",\"A2\"]"); }

            const body = {
                userId: o_userId.value,
                showtimeId: o_showtimeId.value,
                seats: seats,
                totalPrice: parseFloat(o_total.value)
            };

            fetch(`${BASE}/api/orders`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            })
                .then(r => r.text())
                .then(txt => order_create_output.textContent = txt);
        }

        function getUserOrders() {
            const uid = o_userId_hist.value;

            fetch(`${BASE}/api/orders/user/${uid}`)
                .then(r => r.json())
                .then(data => order_history_output.textContent = JSON.stringify(data, null, 2))
                .catch(err => order_history_output.textContent = err);
        }

    </script>

</body>

</html>